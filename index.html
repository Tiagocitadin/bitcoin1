<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acompanhamento de Pre√ßos de Criptomoedas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 50px;
        }
        h1 {
            color: #333;
        }
        #price {
            font-size: 2em;
            color: #007BFF;
        }
        #status {
            margin-top: 20px;
            color: #28a745;
        }
        #currency-select, #target-price {
            margin-bottom: 20px;
        }
        #alert {
            color: #FF0000;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>Acompanhamento de Pre√ßos de Criptomoedas</h1>

    <!-- Sele√ß√£o da moeda -->
    <select id="currency-select">
        <option value="BTC">Bitcoin (BTC)</option>
        <option value="ETH">Ethereum (ETH)</option>
        <option value="LTC">Litecoin (LTC)</option>
        <option value="XRP">Ripple (XRP)</option>
        <option value="SHIB">Shiba Inu (SHI)</option>
    </select>

    <!-- Campo para o usu√°rio definir o valor alvo -->
    <label for="target-price">Defina o valor alvo (R$):</label>
    <input type="number" id="target-price" placeholder="Ex: 180000.0" step="0.01">

    <!-- Exibi√ß√£o do pre√ßo e status -->
    <div id="price">Carregando...</div>
    <div id="status"></div>
    <div id="alert"></div>

    <script>
        async function fetchCryptoPrice(currency) {
            try {
                // Faz a requisi√ß√£o para o backend Spring Boot
                const response = await fetch(`http://localhost:8080/api/${currency}-price`);
                const data = await response.json();

                // Verifica se os dados da API est√£o corretos
                if (data && data.ticker && data.ticker.last) {
                    const currentPrice = parseFloat(data.ticker.last);
                    if (!isNaN(currentPrice)) {
                        // Formata o pre√ßo para moeda BRL
                        const formattedPrice = new Intl.NumberFormat('pt-BR', {
                            style: 'currency',
                            currency: 'BRL',
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 10
                        }).format(currentPrice);

                        // Exibe o pre√ßo formatado
                        document.getElementById('price').innerText = formattedPrice;

                        // Obt√©m o valor alvo inserido pelo usu√°rio
                        const targetPriceInput = document.getElementById('target-price').value;
                        const targetPrice = parseFloat(targetPriceInput);

                        // Verifica se o pre√ßo atingiu o valor alvo
                        if (!isNaN(targetPrice) && currentPrice >= targetPrice) {
                            document.getElementById('status').innerText = "üö® Alerta: Pre√ßo atingiu o valor alvo!";
                            document.getElementById('alert').innerText = `A moeda ${currency} atingiu o valor alvo de R$ ${targetPrice}!`;
                        } else {
                            document.getElementById('status').innerText = "Pre√ßo abaixo do valor alvo.";
                            document.getElementById('alert').innerText = "";
                        }
                    } else {
                        document.getElementById('price').innerText = "Erro: Valor inv√°lido.";
                    }
                } else {
                    document.getElementById('price').innerText = "Erro ao obter o pre√ßo.";
                }
            } catch (error) {
                document.getElementById('price').innerText = "Erro ao obter o pre√ßo.";
                console.error("Erro ao obter dados da API:", error);
            }
        }

        // Atualiza o pre√ßo a cada 10 segundos
        function updatePrice() {
            const currency = document.getElementById('currency-select').value;
            fetchCryptoPrice(currency);
        }

        // Atualizar o pre√ßo ao mudar a moeda selecionada
        document.getElementById('currency-select').addEventListener('change', updatePrice);

        // Atualizar o pre√ßo automaticamente a cada 10 segundos
        setInterval(updatePrice, 5000);
        updatePrice();
    </script>

</body>
</html>
